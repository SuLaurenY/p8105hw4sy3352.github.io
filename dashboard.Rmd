---
title: "Manhattan Restaurant Pre-permit Inspection Score (2019)"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

### NYC Restaurant Inspections

<div style="max-width:300px">
Plots on this page shows pre-permit restaurant inspection results in Manhattan during 2019.  
In chart A, it shows the overall score distribution of each cuisine type.  
In chart B, the bar represents each cuisine type's average score.  
In chart C, each point represents a restaurant inspected.  
The **color corresponds to the inspection score**, where a **higher score indicates more violations or lower compliance**.  
By visualizing the data through interactive plots, we can have a better idea of Manhattan's restaurant violations.  

</div>

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(p8105.datasets)
library(plotly)
data("rest_inspec")
```
Column {data-width=650}
-----------------------------------------------------------------------
### Chart A - Score Distribution by Cuisine
```{r}
res_df = rest_inspec |> 
  filter(boro == "Manhattan", 
         critical_flag == "Y", 
         substr(inspection_date,1,4) == "2019",
         !is.na(grade_date),
         !is.na(violation_description),
         !is.na(latitude),
         !is.na(longitude),
         startsWith(`inspection_type`, "Pre-permit")) |> 
  select(-camis, -boro)

sc_cuisine_box = res_df |>
  select(cuisine_description, score) |> 
  mutate(cuisine_description = fct_reorder(
    cuisine_description, score, .fun = median, .desc = FALSE)) |> 
  plot_ly(
    x = ~cuisine_description, y = ~score, type = "box", 
    color = ~cuisine_description, colors = "viridis",
    showlegend = FALSE) |> 
    layout(xaxis = list(title = "Cuisine Type", tickangle = -45))
sc_cuisine_box
```

Column {data-width=350}
-----------------------------------------------------------------------
### Chart B - Average Score by Cuisine
```{r}
avg_sc_cuisine = res_df |>
  select(cuisine_description, score) |> 
  group_by(cuisine_description) |> 
  summarize(mean_score = mean(score, na.rm = TRUE)) |> 
  mutate(cuisine_description = fct_reorder(
    cuisine_description, mean_score)) |> 
  plot_ly(
    x = ~cuisine_description, y = ~mean_score, type = "bar", 
    color = ~cuisine_description, colors = "viridis", 
    showlegend = FALSE) |> 
  layout(xaxis = list(title = "Cuisine Type", tickangle = -45))
avg_sc_cuisine
```
### Chart C - Inspected Restaurant Map
```{r}
map_pt = res_df |> 
  mutate(text_label = str_c(
    "Name:", dba, "\nCuisine:", cuisine_description)) |> 
  plot_ly(
    x = ~latitude, y = ~longitude, type = "scatter", 
    mode = "markers", color = ~score, text = ~text_label, 
    hoverinfo = "text"
  ) |> 
  layout(xaxis = list(title = "Latitude", range = c(40.6,40.9)),
         yaxis = list(title = "Longitude", range = c(-74.1,-73.9)))
map_pt
```

